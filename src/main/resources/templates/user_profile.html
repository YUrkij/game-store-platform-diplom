<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Профиль пользователя - GameStore</title>
  <style>
    /* Все стили из common.html */
    :root { /* ... */ }
    .dark-theme { /* ... */ }
    * { /* ... */ }
    body { /* ... */ }
    header { /* ... */ }
    .header-content { /* ... */ }
    .logo { /* ... */ }
    .auth-buttons { /* ... */ }
    .user-info { /* ... */ }
    .balance { /* ... */ }
    .btn { /* ... */ }
    .btn-primary { /* ... */ }
    .btn-secondary { /* ... */ }
    .btn-small { /* ... */ }
    main { /* ... */ }
    footer { /* ... */ }
    .footer-content { /* ... */ }
    .theme-switcher { /* ... */ }
    .games-grid { /* ... */ }
    .game-card { /* ... */ }
    .game-image { /* ... */ }
    .modal { /* ... */ }
    .modal-content { /* ... */ }

    /* Дополнительные стили для user_profile */
    .admin-actions {
        display: flex;
        gap: 1rem;
        margin: 2rem 0;
    }

    .user-details {
        background: var(--bg-card);
        padding: 2rem;
        border-radius: 10px;
        margin-bottom: 2rem;
        box-shadow: var(--shadow);
    }

    .detail-row {
        display: grid;
        grid-template-columns: 200px 1fr;
        margin-bottom: 1rem;
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--border-color);
    }

    .banned {
        color: #ff6b6b;
        font-weight: bold;
    }

    .admin-badge {
        background: #ff6b6b;
        color: white;
        padding: 0.2rem 0.5rem;
        border-radius: 3px;
        font-size: 0.8rem;
        margin-left: 0.5rem;
    }

    .superadmin-badge {
        background: #ffd93d;
        color: #333;
        padding: 0.2rem 0.5rem;
        border-radius: 3px;
        font-size: 0.8rem;
        margin-left: 0.5rem;
    }
  </style>
</head>
<body>
<header>
  <div class="header-content">
    <div class="logo">GameStore</div>
    <div class="auth-buttons" id="authButtons"></div>
  </div>
</header>

<main>
  <div id="adminContent">
    <!-- Контент для админов -->
  </div>
</main>

<!-- Модальное окно подтверждения -->
<div id="confirmModal" class="modal">
  <div class="modal-content">
    <h3 id="confirmTitle">Подтверждение действия</h3>
    <p id="confirmMessage">Вы уверены, что хотите выполнить это действие?</p>
    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
      <button class="btn btn-primary" id="confirmAction">Подтвердить</button>
      <button class="btn btn-secondary" onclick="closeModal('confirmModal')">Отмена</button>
    </div>
  </div>
</div>

<footer>
  <div class="footer-content">
    <div>&copy; 2024 GameStore Platform. Все права защищены.</div>
    <div class="theme-switcher" onclick="toggleTheme()">
      <span id="themeText">Тёмная тема</span>
    </div>
  </div>
</footer>

<script>
  function loadUserProfile() {
      // Проверяем права доступа
      if (!currentUser || (currentUser.role !== 'ADMIN' && currentUser.role !== 'SUPERADMIN')) {
          document.getElementById('adminContent').innerHTML = `
              <h1>Доступ запрещен</h1>
              <p>У вас недостаточно прав для просмотра этой страницы.</p>
          `;
          return;
      }

      const urlParams = new URLSearchParams(window.location.search);
      const userId = parseInt(urlParams.get('id'));

      const users = JSON.parse(localStorage.getItem('users')) || [];
      const targetUser = users.find(u => u.id === userId);

      if (!targetUser) {
          document.getElementById('adminContent').innerHTML = '<h1>Пользователь не найден</h1>';
          return;
      }

      document.getElementById('adminContent').innerHTML = `
          <h1>Профиль пользователя</h1>

          <div class="user-details">
              <div class="detail-row">
                  <strong>ID:</strong>
                  <span>${targetUser.id}</span>
              </div>
              <div class="detail-row">
                  <strong>Имя пользователя:</strong>
                  <span>${targetUser.username}
                      ${targetUser.role === 'ADMIN' ? '<span class="admin-badge">ADMIN</span>' : ''}
                      ${targetUser.role === 'SUPERADMIN' ? '<span class="superadmin-badge">SUPERADMIN</span>' : ''}
                  </span>
              </div>
              <div class="detail-row">
                  <strong>Email:</strong>
                  <span>${targetUser.email}</span>
              </div>
              <div class="detail-row">
                  <strong>Роль:</strong>
                  <span>${targetUser.role}</span>
              </div>
              <div class="detail-row">
                  <strong>Баланс:</strong>
                  <span>${targetUser.balance} ₽</span>
              </div>
              <div class="detail-row">
                  <strong>Статус:</strong>
                  <span class="${targetUser.isBanned ? 'banned' : ''}">
                      ${targetUser.isBanned ? 'ЗАБЛОКИРОВАН' : 'Активен'}
                  </span>
              </div>
              <div class="detail-row">
                  <strong>Дата регистрации:</strong>
                  <span>${new Date(targetUser.createdAt || Date.now()).toLocaleDateString()}</span>
              </div>
              <div class="detail-row">
                  <strong>Количество игр:</strong>
                  <span>${targetUser.library ? targetUser.library.length : 0}</span>
              </div>
          </div>

          <div class="admin-actions">
              ${targetUser.role !== 'SUPERADMIN' || currentUser.role === 'SUPERADMIN' ? `
                  <button class="btn ${targetUser.isBanned ? 'btn-primary' : 'btn-secondary'}"
                          onclick="toggleBan(${targetUser.id}, ${!targetUser.isBanned})">
                      ${targetUser.isBanned ? 'Разблокировать' : 'Заблокировать'}
                  </button>
              ` : ''}

              ${currentUser.role === 'SUPERADMIN' && targetUser.role !== 'SUPERADMIN' ? `
                  <a href="change_role.html?id=${targetUser.id}" class="btn btn-primary">Изменить роль</a>
              ` : ''}

              <a href="admin_users.html" class="btn btn-secondary">Назад к списку</a>
          </div>

          ${targetUser.library && targetUser.library.length > 0 ? `
              <h2>Библиотека пользователя</h2>
              <div class="games-grid">
                  ${targetUser.library.map(game => `
                      <div class="game-card">
                          <img src="${game.image}" alt="${game.title}" class="game-image">
                          <h3>${game.title}</h3>
                          <p>Куплено: ${new Date(game.purchaseDate).toLocaleDateString()}</p>
                          <p>Цена: ${game.purchasePrice} ₽</p>
                      </div>
                  `).join('')}
              </div>
          ` : '<p>У пользователя нет игр в библиотеке.</p>'}
      `;
  }

  function toggleBan(userId, banStatus) {
      const action = banStatus ? 'заблокировать' : 'разблокировать';
      const message = `Вы уверены, что хотите ${action} этого пользователя?`;

      document.getElementById('confirmTitle').textContent = `Подтверждение ${action}`;
      document.getElementById('confirmMessage').textContent = message;

      document.getElementById('confirmAction').onclick = function() {
          performBan(userId, banStatus);
      };

      document.getElementById('confirmModal').style.display = 'block';
  }

  function performBan(userId, banStatus) {
      const users = JSON.parse(localStorage.getItem('users'));
      const userIndex = users.findIndex(u => u.id === userId);

      if (userIndex !== -1) {
          users[userIndex].isBanned = banStatus;
          localStorage.setItem('users', JSON.stringify(users));

          // Если это текущий пользователь, обновляем его данные
          if (currentUser.id === userId) {
              currentUser.isBanned = banStatus;
              localStorage.setItem('currentUser', JSON.stringify(currentUser));
          }

          closeModal('confirmModal');
          loadUserProfile(); // Перезагружаем страницу

          alert(`Пользователь успешно ${banStatus ? 'заблокирован' : 'разблокирован'}!`);
      }
  }

  function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
  }

  // Инициализация
  document.addEventListener('DOMContentLoaded', function() {
      loadTheme();
      updateAuthButtons();
      loadUserProfile();
  });

  // Функции из common.html
  function toggleTheme() { /* ... */ }
  function loadTheme() { /* ... */ }
  function updateAuthButtons() { /* ... */ }
  function logout() { /* ... */ }
</script>
</body>
</html>